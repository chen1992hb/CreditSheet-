# coding:utf-8
import pandas as pd
import numpy as np
import openpyxl
from openpyxl import load_workbook
#绩效文件名
fileSource = "202003.xlsx"

#创建缓存区
writer = pd.ExcelWriter(fileSource)
book = load_workbook(fileSource)
writer.book = book


# excel地址


def count(sheet_name,result_sheet_name):
    #读取sheet
    df = pd.DataFrame(pd.read_excel(fileSource, sheet_name=sheet_name))
    date = df.values
    #创建临时姓名、绩效list
    names = []
    credit_list = []
    credit_map = {}
    #遍历和赋值
    for rows in date:
        if rows[0] == '姓名':
            for name in rows:
                # print(name)
                names.append(name)

        if rows[0] == '核准':
            for credit in rows:
                # print(credit)
                credit_list.append(credit)
    #print(names)
    #print(credit_list)
    #建立洗牌后和合计的姓名数据列表
    true_name = []
    true_credits = []
    for index in range(len(names)):
        name = names[index]
        credit = credit_list[index]
        if type(credit) == int and type(name) != int and not pd.isnull(name) :
            if type(credit_map.get(name)) == int and type(name) != int:
                credit_map[name] = credit_map.get(name) + credit
            else:
                credit_map[name] = credit
    print(result_sheet_name)
    print(credit_map)
    for key in credit_map.keys():
        true_name.append(key)
        true_credits.append(credit_map[key])

    #格式化数据
    dic = {'姓名': true_name, '合计': true_credits}
    df1 = pd.DataFrame(dic)
    #写入sheet
    df1.to_excel(writer, sheet_name=result_sheet_name,index=False)
    writer.save()


count(sheet_name='项目详情',result_sheet_name='项目统计')
count(sheet_name='Fu+实施',result_sheet_name='Fu+统计')
count(sheet_name='数据处理',result_sheet_name='数据统计')
